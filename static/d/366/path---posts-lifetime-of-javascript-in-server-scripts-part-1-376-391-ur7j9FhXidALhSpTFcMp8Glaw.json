{"data":{"site":{"siteMetadata":{"author":{"name":"Samuel Chan","contacts":{"twitter":"#"}},"disqusShortname":"","subtitle":"Samuel Chan blogs here about the geekier parts of his life.","title":"Sam Does Blogs","url":"https://blog.samuelchan.dev"}},"markdownRemark":{"id":"619011ab-2ac5-5582-9a97-339d7da63b69","html":"<p>An often under-utilised capability of IBM BPM is its ability to automatically\nload server-side JavaScript files in a process application or a toolkit.\nYou may be using them in some way already, in the form of theJSON object\nwhich isn’t available out of the box.</p>\n<p>The script that adds that object is nothing more than plain JS (IBM BPM’s\nembedded JS engine, Rhino, supports up to ES5), which means you can create\nyour own internal libraries of functions, increasing the DRY-ness of your\napplication.</p>\n<p>But maybe you already knew this and you’re big proponent of writing good\nJS in your BPM apps. However, do you know under what conditions your bit\nof JS lives and dies?</p>\n<ul>\n<li>When is your server side JS run?</li>\n<li>How often does it re-initialise?</li>\n</ul>\n<p>(For this post, I’ll be using the term ‘JS context’ to refer to a single\nJS execution context. For example, if you were caching values, this context\nis where your values live. Separate contexts do not share values.)</p>\n<p>I had done some experimenting on my own and had some basic answers, but\nafter reading <a href=\"http://developer.ibm.com/answers/comments/413126/view.html\">this comment</a>\non dW Answers I had to conduct a full and thorough investigation!</p>\n<h2 id=\"setup\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<p>Our setup has the following parts:</p>\n<ul>\n<li>A toolkit with the managed server JS file (“A Server JS File” toolkit)</li>\n<li>Two identical process apps (“App 1” and “App 2”)</li>\n</ul>\n<h3 id=\"the-server-js-file\"><a href=\"#the-server-js-file\" aria-label=\"the server js file permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The server JS file</h3>\n<p>A simple log wrapper. It stores its creation timestamp and a random number\n(multiple contexts can be created in the same millisecond).</p>\n<p>When the exported function is called, it prints out the thread name, the\nrandom number, timestamp, and the optional label.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">jssnap <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">var</span> __rand <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">round</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">90000</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n\t\t__when <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\t\t__str <span class=\"token operator\">=</span> __rand <span class=\"token operator\">+</span> <span class=\"token string\">' - '</span> <span class=\"token operator\">+</span> __when<span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token function\">doLog</span><span class=\"token punctuation\">(</span><span class=\"token string\">'init'</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">:</span> doLog\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\">//</span>\n\n\t<span class=\"token keyword\">function</span> <span class=\"token function\">doLog</span><span class=\"token punctuation\">(</span>label<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">'JS Snapshot - '</span> <span class=\"token operator\">+</span>\n\t\t\t<span class=\"token function\">padRight</span><span class=\"token punctuation\">(</span><span class=\"token number\">37</span><span class=\"token punctuation\">,</span> <span class=\"token function\">getThreadName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span>\n\t\t\t<span class=\"token string\">' - '</span> <span class=\"token operator\">+</span> __str <span class=\"token operator\">+</span>\n\t\t\t<span class=\"token string\">' - '</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>label <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">function</span> <span class=\"token function\">getThreadName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> Packages<span class=\"token punctuation\">.</span>java<span class=\"token punctuation\">.</span>lang<span class=\"token punctuation\">.</span>Thread<span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>name\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">function</span> <span class=\"token function\">padRight</span><span class=\"token punctuation\">(</span>len<span class=\"token punctuation\">,</span> str<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t  \t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> str <span class=\"token operator\">===</span> <span class=\"token string\">'undefined'</span><span class=\"token punctuation\">)</span>\n\t    \t<span class=\"token keyword\">return</span> pad<span class=\"token punctuation\">;</span>\n\n\t\t<span class=\"token keyword\">var</span> pad <span class=\"token operator\">=</span> <span class=\"token function\">Array</span><span class=\"token punctuation\">(</span>len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">' '</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>str <span class=\"token operator\">+</span> pad<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">substring</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3 id=\"the-processes-and-service\"><a href=\"#the-processes-and-service\" aria-label=\"the processes and service permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Process(es) and Service</h3>\n<p>The identical processes (note, the new ‘Process’ type, not BPD, but doubt either will behave differently) in each of the apps are simple:</p>\n<ul>\n<li>first step is a system service — its implementation just has a script to make a call to the JS method <code class=\"language-text\">jssnap.log(‘service call from process X’)</code> where ‘X’ is whichever process app it was in.</li>\n<li>second step is a process-level script which makes a similar call <code class=\"language-text\">jssnap.log(‘process script call in process X’)</code></li>\n</ul>\n<p>Both steps are configured as a multi-instance loop = 5, to test if concurrent contexts are created and used if demand was high enough.</p>\n<p>The service in step 1 will also be executed separately to test standalone behaviour.</p>\n<h2 id=\"test-method\"><a href=\"#test-method\" aria-label=\"test method permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test Method</h2>\n<p>I’m running on 8.6.0, in a SingleCluster configuration for both my Center and online Server.</p>\n<p>On the Process Center:</p>\n<ol>\n<li>Run Process in App 1. Run Process in App 2.</li>\n<li>Run standalone service in App 1. Also for App 2.</li>\n<li>Trigger a new snapshot (make a non-functional change: update documentation, or similar) and save.</li>\n<li>Repeat step 1 and 2.</li>\n</ol>\n<p>On the Process Server:</p>\n<ol>\n<li>Install V1</li>\n<li>Run Process in App 1. Run Process in App 2.</li>\n<li>Run standalone service in App 1, and in App 2.</li>\n<li>Install V2 (no function changes, as above) — leave, do not migrate</li>\n<li>Repeat step 2 and 3 for V2</li>\n<li>Repeat step 2 and 3 for V1</li>\n</ol>\n<p><em>The upcoming Part 2 will contain the results of the Process Server portion of the test. The Process Center results are below.</em></p>\n<h2 id=\"behold-the-results-part-1-at-least\"><a href=\"#behold-the-results-part-1-at-least\" aria-label=\"behold the results part 1 at least permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Behold, the results (part 1, at least)!</h2>\n<p>The original logs are also available <a href=\"https://gist.github.com/sammich/4361337a1e7d63188d062dd99dcfac04\">here</a>.\nThe logs below have been trimmed and emoji-fied for easier correlation.</p>\n<p>Let’s break this down:</p>\n<ul>\n<li>When a Process is run, two contexts are created for threads named: WebContainer, WorkManager (lazy instantiation)</li>\n<li>Running a Process (or service) from a new Snapshot, will create new contexts</li>\n<li>WebContainer, WorkManager threads are just names — contexts are seemingly portable (e.g.: follow the 🍊)</li>\n<li>Contexts exist for each snapshot concurrently (follow the markers below between the initial and re-runs for both apps) and are not shared</li>\n<li>If the demand requires it, multiple contexts named ‘WorkManager’ can be created. Below we can see two always being created, but the second is never actually used</li>\n<li>Standalone service calls are always executed on a thread named ‘WebContainer’.</li>\n<li>(bonus — this isn’t reflected in the logs below, just trust me :) ) After a new snapshot, running a service will create a WebContainer context without creating the WorkManager context.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Emoji are used below because it&#39;s easier to correlate coloured icons than letters/numbers. If you\ndon&#39;t see any and only see squares, I will suggest you hop over to the raw log:\n\n   https://gist.github.com/sammich/4361337a1e7d63188d062dd99dcfac04\n\n❓ - a JS context that is initialised but never actually used\n\n[log time ] [thread name:id]       [context created time]\n\n// run app 1 process\n\n[02:30:401] WebContainer:3  - 🍊 - 02:30.401 - init\n[02:30:697] WorkManager:294 - 🍏 - 02:30.697 - init\n[02:30:697] WorkManager:332 - ❓ - 02:30.697 - init\n[02:30:697] WorkManager:294 - 🍏 - 02:30.697 - service call from process 1\n[02:30:713] WorkManager:332 - 🍏 - 02:30.697 - service call from process 1\n[02:30:776] WorkManager:334 - 🍏 - 02:30.697 - service call from process 1\n[02:30:776] WorkManager:331 - 🍏 - 02:30.697 - service call from process 1\n[02:30:791] WorkManager:333 - 🍏 - 02:30.697 - service call from process 1\n[02:31:197] WorkManager:333 - 🍊 - 02:30.401 - process script call in process 1\n[02:31:213] WorkManager:333 - 🍊 - 02:30.401 - process script call in process 1\n[02:31:213] WorkManager:333 - 🍊 - 02:30.401 - process script call in process 1\n[02:31:213] WorkManager:333 - 🍊 - 02:30.401 - process script call in process 1\n[02:31:229] WorkManager:333 - 🍊 - 02:30.401 - process script call in process 1\n\n// run app 2 process\n\n[02:36:729] WebContainer:6  - ⚽️ - 02:36.729 - init\n[02:37:026] WorkManager:294 - ❓ - 02:37.026 - init\n[02:37:026] WorkManager:332 - 🏈 - 02:37.026 - init\n[02:37:041] WorkManager:332 - 🏈 - 02:37.026 - service call from process 2\n[02:37:057] WorkManager:294 - 🏈 - 02:37.026 - service call from process 2\n[02:37:120] WorkManager:335 - 🏈 - 02:37.026 - service call from process 2\n[02:37:151] WorkManager:294 - 🏈 - 02:37.026 - service call from process 2\n[02:37:166] WorkManager:332 - 🏈 - 02:37.026 - service call from process 2\n[02:37:635] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n[02:37:651] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n[02:37:651] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n[02:37:666] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n[02:37:666] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n\n// re-run app 1 process\n\n[02:50:558] WorkManager:332 - 🍏 - 02:30.697 - service call from process 1\n[02:50:558] WorkManager:294 - 🍏 - 02:30.697 - service call from process 1\n[02:50:620] WorkManager:332 - 🍏 - 02:30.697 - service call from process 1\n[02:50:620] WorkManager:294 - 🍏 - 02:30.697 - service call from process 1\n[02:50:667] WorkManager:334 - 🍏 - 02:30.697 - service call from process 1\n[02:50:933] WorkManager:336 - 🍊 - 02:30.401 - process script call in process 1\n[02:50:933] WorkManager:336 - 🍊 - 02:30.401 - process script call in process 1\n[02:50:948] WorkManager:336 - 🍊 - 02:30.401 - process script call in process 1\n[02:50:948] WorkManager:336 - 🍊 - 02:30.401 - process script call in process 1\n[02:50:964] WorkManager:336 - 🍊 - 02:30.401 - process script call in process 1\n\n// re-run app 2 process\n\n[02:55:292] WorkManager:333 - 🏈 - 02:37.026 - service call from process 2\n[02:55:292] WorkManager:331 - 🏈 - 02:37.026 - service call from process 2\n[02:55:355] WorkManager:331 - 🏈 - 02:37.026 - service call from process 2\n[02:55:355] WorkManager:333 - 🏈 - 02:37.026 - service call from process 2\n[02:55:370] WorkManager:335 - 🏈 - 02:37.026 - service call from process 2\n[02:55:605] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n[02:55:605] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n[02:55:605] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n[02:55:622] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n[02:55:622] WorkManager:294 - ⚽️ - 02:36.729 - process script call in process 2\n\n// run the services by themselves\n\n[04:10:309] WebContainer:11 - 🏈 - 02:37.026 - standalone service call from app 2\n[04:20:466] WebContainer:11 - 🍏 - 02:30.697 - standalone service call from app 1\n[04:23:091] WebContainer:11 - 🏈 - 02:37.026 - standalone service call from app 2\n[04:27:685] WebContainer:11 - 🍏 - 02:30.697 - standalone service call from app 1\n\n// took a break here to do a little write up...then ran the processes again\n\n[22:30:084] WorkManager:333 - 🍏 - 02:30.697 - service call from process 1\n[22:30:084] WorkManager:331 - 🍏 - 02:30.697 - service call from process 1\n[22:30:131] WorkManager:331 - 🍏 - 02:30.697 - service call from process 1\n[22:30:131] WorkManager:333 - 🍏 - 02:30.697 - service call from process 1\n[22:30:162] WorkManager:335 - 🍏 - 02:30.697 - service call from process 1\n[22:30:490] WorkManager:294 - 🍊 - 02:30.401 - process script call in process 1\n[22:30:506] WorkManager:294 - 🍊 - 02:30.401 - process script call in process 1\n[22:30:506] WorkManager:294 - 🍊 - 02:30.401 - process script call in process 1\n[22:30:506] WorkManager:294 - 🍊 - 02:30.401 - process script call in process 1\n[22:30:521] WorkManager:294 - 🍊 - 02:30.401 - process script call in process 1\n[22:39:053] WorkManager:331 - 🏈 - 02:37.026 - service call from process 2\n[22:39:053] WorkManager:294 - 🏈 - 02:37.026 - service call from process 2\n[22:39:099] WorkManager:294 - 🏈 - 02:37.026 - service call from process 2\n[22:39:099] WorkManager:331 - 🏈 - 02:37.026 - service call from process 2\n[22:39:146] WorkManager:334 - 🏈 - 02:37.026 - service call from process 2\n[22:39:396] WorkManager:333 - ⚽️ - 02:36.729 - process script call in process 2\n[22:39:396] WorkManager:333 - ⚽️ - 02:36.729 - process script call in process 2\n[22:39:396] WorkManager:333 - ⚽️ - 02:36.729 - process script call in process 2\n[22:39:412] WorkManager:333 - ⚽️ - 02:36.729 - process script call in process 2\n[22:39:412] WorkManager:333 - ⚽️ - 02:36.729 - process script call in process 2\n\n// made a small change to trigger new snapshots to be made - re-ran both processes\n\n[26:45:486] WebContainer:0  - 🎁 - 26:45.486 - init\n[26:45:735] WorkManager:339 - 🔦 - 26:45.735 - init\n[26:45:751] WorkManager:339 - 🔦 - 26:45.735 - service call from process 1\n[26:45:766] WorkManager:333 - ❓ - 26:45.766 - init\n[26:45:907] WorkManager:333 - 🔦 - 26:45.735 - service call from process 1\n[26:45:923] WorkManager:338 - ❓ - 26:45.907 - init\n[26:45:938] WorkManager:331 - 🔦 - 26:45.735 - service call from process 1\n[26:46:001] WorkManager:338 - 🔦 - 26:45.735 - service call from process 1\n[26:46:032] WorkManager:334 - 🔥 - 26:46.032 - init\n[26:46:048] WorkManager:334 - 🔦 - 26:45.735 - service call from process 1\n[26:46:220] WorkManager:339 - 🎁 - 26:45.486 - process script call in process 1\n[26:46:220] WorkManager:339 - 🎁 - 26:45.486 - process script call in process 1\n[26:46:220] WorkManager:339 - 🎁 - 26:45.486 - process script call in process 1\n[26:46:220] WorkManager:339 - 🎁 - 26:45.486 - process script call in process 1\n[26:46:220] WorkManager:339 - 🎁 - 26:45.486 - process script call in process 1\n[26:47:454] WebContainer:0  - 💎 - 26:47.454 - init\n[26:47:720] WorkManager:341 - 💰 - 26:47.720 - init\n[26:47:720] WorkManager:339 - ❓ - 26:47.720 - init\n[26:47:735] WorkManager:341 - 💰 - 26:47.720 - service call from process 2\n[26:47:751] WorkManager:339 - 💰 - 26:47.720 - service call from process 2\n[26:47:798] WorkManager:341 - 💰 - 26:47.720 - service call from process 2\n[26:47:798] WorkManager:339 - 💰 - 26:47.720 - service call from process 2\n[26:47:813] WorkManager:342 - 💰 - 26:47.720 - service call from process 2\n[26:48:110] WorkManager:340 - 💎 - 26:47.454 - process script call in process 2\n[26:48:110] WorkManager:340 - 💎 - 26:47.454 - process script call in process 2\n[26:48:126] WorkManager:340 - 💎 - 26:47.454 - process script call in process 2\n[26:48:126] WorkManager:340 - 💎 - 26:47.454 - process script call in process 2\n[26:48:126] WorkManager:340 - 💎 - 26:47.454 - process script call in process 2</code></pre></div>\n<h2 id=\"the-takeaway-akawhat-do-i-do-with-this-info\"><a href=\"#the-takeaway-akawhat-do-i-do-with-this-info\" aria-label=\"the takeaway akawhat do i do with this info permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The takeaway (a.k.a — what do I do with this info?)</h2>\n<ul>\n<li>If you are using any caching mechanisms, or are writing potentially memory-leaky code, the short lifetimes of the JS contexts mean you’re very unlikely to run into any issues on a Center. On a Server, however, you may want to make sure your JS isn’t leaky.</li>\n<li>Unless you have a particularly massive library of server JS in your apps/toolkits, I wouldn’t sweat any ‘JS context creation’ performance hits. It would seem to be a much bigger deal for a Process Center than Servers, in any case, due to the limited number of new snapshots on Servers.</li>\n</ul>\n<p>Bottom line: If your JS was good, I wouldn’t concern yourself with performance</p>\n<p>But if you had so much in-house JS written that it actually is a concern, then there may be more significant problems than the performance hit from loading it.</p>\n<h2 id=\"remaining-questions\"><a href=\"#remaining-questions\" aria-label=\"remaining questions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Remaining Questions</h2>\n<h3 id=\"when-are-these-contexts-destroyed\"><a href=\"#when-are-these-contexts-destroyed\" aria-label=\"when are these contexts destroyed permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>When are these contexts destroyed?</h3>\n<p>Stay tuned for this in part 2.</p>\n<h3 id=\"what-is-the-lifetime-of-a-context-over-a-long-uptime-snapshot\"><a href=\"#what-is-the-lifetime-of-a-context-over-a-long-uptime-snapshot\" aria-label=\"what is the lifetime of a context over a long uptime snapshot permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is the lifetime of a context over a long uptime snapshot?</h3>\n<p>I’ll cover this in Part 2, as it’s much more relevant to Process Servers.</p>\n<h3 id=\"what-are-the-performance-implications\"><a href=\"#what-are-the-performance-implications\" aria-label=\"what are the performance implications permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What are the performance implications?</h3>\n<p>For me to fully answer this question, I’ll also need to run the Process Server tests.</p>\n<p>From a RAM usage perspective, I’ll have to do some digging around and report back.</p>\n<p>Also, stay tuned for a micro-benchmarks post!</p>\n<p>Also, perhaps someone can enlighten me on what Rhino optimisation setting IBM BPM is using?</p>","fields":{"slug":"/posts/lifetime-of-javascript-in-server-scripts-part-1/","tagSlugs":["/tag/ibm-bpm/","/tag/javascript/","/tag/performance/","/tag/process/"]},"frontmatter":{"date":"2017-11-20T14:02:56Z","description":"A deep dive into how IBM BPM handles server scripts. When they're first executed, how often they're created","tags":["IBM BPM","Javascript","Performance","Process"],"title":"Lifetime of JavaScript in Server scripts (part 1)"}}},"pageContext":{"slug":"/posts/lifetime-of-javascript-in-server-scripts-part-1/"}}